<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SITTA - Sistem Informasi Tiras & Transaksi Bahan Ajar UT</title>
    <link rel="stylesheet" href="./assets/css/style.css">
    <!-- Vue.js 2.x dari CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="container">
                <div class="header-left" @click="tab = 'home'" style="cursor: pointer;">
                    <div class="logo">
                        <img src="assets/img/Logo_Universitas_Terbuka.png" alt="Logo UT">
                    </div>
                    <div>
                        <h1>SITTA (Sistem Informasi Tiras & Transaksi Bahan Ajar)</h1>
                    </div>
                </div>
                <div class="header-actions" v-if="tab !== 'home'">
                    <button class="header-nav-btn" :class="{ active: tab === 'stok' }" @click="tab = 'stok'">Stok</button>
                    <button class="header-nav-btn" :class="{ active: tab === 'tracking' }" @click="tab = 'tracking'">Tracking DO</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main" :class="{ 'has-padding': tab !== 'home' }">
            <div class="container">
                <!-- Homepage -->
                <div v-if="tab === 'home'" class="homepage">
                    <div class="homepage-header">
                        <div class="homepage-icon">üéì</div>
                        <h1 class="homepage-title">SITTA</h1>
                        <p class="homepage-subtitle">Sistem Informasi Tiras dan Transaksi Bahan Ajar</p>
                    </div>
                    
                    <div class="homepage-cards">
                        <div class="homepage-card" @click="tab = 'stok'">
                            <div class="homepage-card-icon">üìö</div>
                            <h2 class="homepage-card-title">Stok Bahan Ajar</h2>
                            <p class="homepage-card-description">Kelola dan monitoring stok untuk seluruh UT Daerah</p>
                        </div>
                        
                        <div class="homepage-card" @click="tab = 'tracking'">
                            <div class="homepage-card-icon">üöö</div>
                            <h2 class="homepage-card-title">Tracking Delivery Order</h2>
                            <p class="homepage-card-description">Lacak status pengiriman DO bahan ajar</p>
                        </div>
                    </div>
                    
                    <div class="homepage-footer">
                        Universitas Terbuka ‚Ä¢ SITTA ‚Ä¢ Vue.js ‚Ä¢ Tugas Praktik 3 STSI4209
                    </div>
                </div>

                <!-- Tab Content: Stok Bahan Ajar -->
                <ba-stock-table v-if="tab === 'stok'" @go-home="tab = 'home'"></ba-stock-table>

                <!-- Tab Content: Tracking DO -->
                <do-tracking v-if="tab === 'tracking'" @go-home="tab = 'home'"></do-tracking>

                <!-- Tab Content: Form Pemesanan -->
                <order-form v-if="tab === 'order'" @go-home="tab = 'home'"></order-form>
            </div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="container">
                <p>&copy; Moh. Saefudin Zukhri - Tugas 3 STSI4209 (Vue.js)</p>
            </div>
        </footer>
    </div>

                <!-- Inline Vue Templates -->
<script type="text/x-template" id="tpl-stock">
    <div class="stock-table-container">
        <div class="page-header">
            <h2 class="page-title">üìö Informasi Stok Bahan Ajar</h2>
            <button class="back-btn" @click="$emit('go-home')">‚Üê Kembali</button>
        </div>
        
        <div v-if="loading" class="loading-state"><p>Memuat data stok...</p></div>
        <div v-else-if="error" class="error-state"><p>{{ error }}</p><button class="btn btn-primary" @click="loadData">Coba Lagi</button></div>
        <div v-else>
            <!-- Statistics Cards -->
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-value">{{ uniqueKodeCount }}</div>
                    <div class="stat-label">Total Bahan Ajar</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üíæ</div>
                    <div class="stat-value">{{ filteredAndSortedStok.length }}</div>
                    <div class="stat-label">Data Ditampilkan</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-value">{{ totalQty }}</div>
                    <div class="stat-label">Total Stok</div>
                </div>
            </div>
            <div class="filter-section">
                <h3>üîç Filter & Sort</h3>
                <div class="filter-grid">
                    <div class="filter-item">
                        <label for="filter-upbjj">UT-Daerah:</label>
                        <select id="filter-upbjj" v-model="filterUpbjj" class="form-control">
                            <option value="">-- Semua UPBJJ --</option>
                            <option v-for="upbjj in upbjjList" :key="upbjj" :value="upbjj">{{ upbjj }}</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label for="filter-kategori">Kategori:</label>
                        <select id="filter-kategori" v-model="filterKategori" class="form-control" :disabled="!filterUpbjj">
                            <option value="">-- Semua Kategori --</option>
                            <option v-for="kategori in availableKategori" :key="kategori" :value="kategori">{{ kategori }}</option>
                        </select>
                        <small v-if="!filterUpbjj" class="form-hint">Pilih UT-Daerah terlebih dahulu</small>
                    </div>
                    <div class="filter-item checkbox-item">
                        <label><input type="checkbox" v-model="filterStokKritis"> Stok Menipis (Qty < Safety)</label>
                    </div>
                    <div class="filter-item checkbox-item">
                        <label><input type="checkbox" v-model="filterStokKosong"> Stok Kosong (Qty = 0)</label>
                    </div>
                    <div class="filter-item">
                        <button class="btn btn-secondary" @click="resetFilters" :disabled="!hasActiveFilters">üîÑ Reset Filter</button>
                    </div>
                </div>
            </div>
            <div class="table-section">
                <div class="table-header">
                    <h3>Data Stok</h3>
                    <p class="table-info">Menampilkan {{ filteredAndSortedStok.length }} dari {{ stokList.length }} item</p>
                    <div class="table-actions"><button class="btn btn-primary" @click="openCreateModal">‚ûï Tambah</button></div>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th @click="toggleSort('kode')" class="sortable">Kode <span v-if="sortBy === 'kode'">{{ sortOrder === 'asc' ? '‚ñ≤' : '‚ñº' }}</span></th>
                                <th @click="toggleSort('judul')" class="sortable">Judul <span v-if="sortBy === 'judul'">{{ sortOrder === 'asc' ? '‚ñ≤' : '‚ñº' }}</span></th>
                                <th>Kategori</th>
                                <th>UT-Daerah</th>
                                <th>Lokasi Rak</th>
                                <th @click="toggleSort('harga')" class="sortable text-right">Harga <span v-if="sortBy === 'harga'">{{ sortOrder === 'asc' ? '‚ñ≤' : '‚ñº' }}</span></th>
                                <th @click="toggleSort('qty')" class="sortable text-right">Qty <span v-if="sortBy === 'qty'">{{ sortOrder === 'asc' ? '‚ñ≤' : '‚ñº' }}</span></th>
                                <th class="text-right">Safety</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-if="filteredAndSortedStok.length === 0"><td colspan="11" class="text-center">Tidak ada data yang sesuai dengan filter</td></tr>
                            <tr v-for="(item, index) in filteredAndSortedStok" :key="item.kode">
                                <td>{{ index + 1 }}</td>
                                <td><strong>{{ item.kode }}</strong></td>
                                <td>{{ item.judul }}</td>
                                <td>{{ item.kategori }}</td>
                                <td>{{ item.upbjj }}</td>
                                <td>{{ item.lokasiRak }}</td>
                                <td class="text-right">{{ item.harga | currency }}</td>
                                <td class="text-right">{{ item.qty | qty }}</td>
                                <td class="text-right">{{ item.safety | qty }}</td>
                                <td><div :title="plainCatatan(item.catatanHTML)"><status-badge :qty="item.qty" :safety="item.safety" :catatan="item.catatanHTML"></status-badge></div></td>
                                <td><button class="btn btn-sm btn-primary" @click="openEditModal(item)">‚úèÔ∏è Edit</button> <button class="btn btn-sm btn-secondary" @click="deleteStok(item)">üóëÔ∏è Hapus</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <app-modal :show="showModal" title="‚úèÔ∏è Edit Stok Bahan Ajar" size="large" @close="closeModal">
            <form @submit.prevent="saveEdit" class="edit-form" @keyup.enter="saveEdit">
                <div class="form-row">
                    <div class="form-group"><label>Kode:</label><input type="text" v-model="editForm.kode" class="form-control" :disabled="!isCreate"></div>
                    <div class="form-group"><label>Judul: *</label><input type="text" v-model="editForm.judul" class="form-control" :class="{ 'is-invalid': validationErrors.judul }"><span v-if="validationErrors.judul" class="error-message">{{ validationErrors.judul }}</span></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Kategori: *</label><select v-model="editForm.kategori" class="form-control" :class="{ 'is-invalid': validationErrors.kategori }"><option value="">-- Pilih Kategori --</option><option v-for="kategori in kategoriList" :key="kategori" :value="kategori">{{ kategori }}</option></select><span v-if="validationErrors.kategori" class="error-message">{{ validationErrors.kategori }}</span></div>
                    <div class="form-group"><label>UT-Daerah: *</label><select v-model="editForm.upbjj" class="form-control" :class="{ 'is-invalid': validationErrors.upbjj }"><option value="">-- Pilih UT-Daerah --</option><option v-for="upbjj in upbjjList" :key="upbjj" :value="upbjj">{{ upbjj }}</option></select><span v-if="validationErrors.upbjj" class="error-message">{{ validationErrors.upbjj }}</span></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Lokasi Rak: *</label><input type="text" v-model="editForm.lokasiRak" class="form-control" :class="{ 'is-invalid': validationErrors.lokasiRak }"><span v-if="validationErrors.lokasiRak" class="error-message">{{ validationErrors.lokasiRak }}</span></div>
                    <div class="form-group"><label>Harga: *</label><input type="number" v-model.number="editForm.harga" class="form-control" :class="{ 'is-invalid': validationErrors.harga }"><span v-if="validationErrors.harga" class="error-message">{{ validationErrors.harga }}</span></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Qty: *</label><input type="number" v-model.number="editForm.qty" class="form-control" :class="{ 'is-invalid': validationErrors.qty }"><span v-if="validationErrors.qty" class="error-message">{{ validationErrors.qty }}</span></div>
                    <div class="form-group"><label>Safety Stock: *</label><input type="number" v-model.number="editForm.safety" class="form-control" :class="{ 'is-invalid': validationErrors.safety }"><span v-if="validationErrors.safety" class="error-message">{{ validationErrors.safety }}</span></div>
                </div>
                <div class="form-group"><label>Catatan HTML:</label><textarea v-model="editForm.catatanHTML" class="form-control" rows="3" placeholder="Gunakan tag HTML seperti <em>, <strong>, <u>, dll."></textarea><small class="form-hint">Preview: <span v-html="editForm.catatanHTML"></span></small></div>
            </form>
            <template v-slot:footer><button class="btn btn-secondary" @click="closeModal">Batal</button> <button class="btn btn-primary" @click="saveEdit">üíæ Simpan</button></template>
        </app-modal>
    </div>
</script>
<script type="text/x-template" id="tpl-tracking">
    <div class="tracking-container">
        <div class="page-header">
            <h2 class="page-title">üöö Tracking Delivery Order</h2>
            <button class="back-btn" @click="$emit('go-home')">‚Üê Kembali</button>
        </div>
        
        <div v-if="loading" class="loading-state"><p>Memuat data tracking...</p></div>
        <div v-else-if="error" class="error-state"><p>{{ error }}</p><button class="btn btn-primary" @click="loadData">Coba Lagi</button></div>
        <div v-else>
            <!-- Tracking Tabs -->
            <div class="tracking-tabs">
                <button class="tracking-tab-btn active">
                    üîç Cek Status DO
                </button>
                <button class="tracking-tab-btn" @click="$emit('go-home'); $parent.tab = 'order'">
                    ‚ûï Tambah DO Baru
                </button>
            </div>
            
            <div class="search-section">
                <h3>Cek Status Pengiriman</h3>
                <p style="color: #666; margin-bottom: 15px;">Masukkan nomor Delivery Order atau NIM untuk melacak status pengiriman bahan ajar Anda.</p>
                
                <!-- Search Type Selector -->
                <div style="margin-bottom: 15px;">
                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">Cari berdasarkan:</label>
                    <div style="display: flex; gap: 15px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" v-model="searchType" value="nomor" name="searchType" style="margin-right: 6px;">
                            <span>Nomor DO</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="radio" v-model="searchType" value="nim" name="searchType" style="margin-right: 6px;">
                            <span>NIM</span>
                        </label>
                    </div>
                </div>
                
                <div class="search-form">
                    <input 
                        type="text" 
                        v-model="searchQuery" 
                        @keyup.enter="searchDO" 
                        @keyup.esc="resetSearch" 
                        class="form-control search-input" 
                        :placeholder="searchType === 'nomor' ? 'Contoh: DO2025-001' : 'Contoh: 123456789'">
                    <button class="btn btn-primary" @click="searchDO" style="padding: 10px 30px;">Lacak</button>
                    <button class="btn btn-secondary" @click="resetSearch" v-if="selectedDO || searchError">Reset</button>
                </div>
                <div v-if="searchError" class="alert alert-error">{{ searchError }}</div>
            </div>
            <div v-if="selectedDO" class="do-detail">
                <div class="do-header"><h3>Detail Delivery Order</h3><span class="do-number">{{ selectedDO.nomorDO }}</span></div>
                <div class="do-info-grid">
                    <div class="info-item"><label>NIM:</label><span>{{ selectedDO.nim }}</span></div>
                    <div class="info-item"><label>Nama:</label><span>{{ selectedDO.nama }}</span></div>
                    <div class="info-item"><label>Status:</label><span class="badge" :class="'badge-' + selectedDO.status.toLowerCase().replace(/ /g, '-')">{{ selectedDO.status }}</span></div>
                    <div class="info-item"><label>Ekspedisi:</label><span>{{ selectedDO.ekspedisi }}</span></div>
                    <div class="info-item"><label>Tanggal Kirim:</label><span>{{ formatDate(selectedDO.tanggalKirim) }}</span></div>
                    <div class="info-item"><label>Paket:</label><span>{{ selectedDO.paket }}</span></div>
                    <div class="info-item"><label>Total:</label><span class="total-price">{{ formatCurrency(selectedDO.total) }}</span></div>
                </div>
                <div class="progress-section"><h4>Progress Pengiriman</h4><div class="progress-bar-container"><div class="progress-bar" :class="progressClass" :style="{ width: progressPercentage + '%' }"><span class="progress-text">{{ progressPercentage }}%</span></div></div></div>
                <div class="timeline-section"><h4>üìç Timeline Perjalanan</h4><div v-if="!selectedDO.perjalanan || selectedDO.perjalanan.length === 0" class="no-timeline"><p>Belum ada data perjalanan</p></div><div v-else class="timeline"><div v-for="(event, index) in selectedDO.perjalanan" :key="index" class="timeline-item" :class="{ 'timeline-latest': index === selectedDO.perjalanan.length - 1 }"><div class="timeline-marker"></div><div class="timeline-content"><div class="timeline-time">{{ event.waktu }}</div><div class="timeline-description">{{ event.keterangan }}</div></div></div></div></div>
            </div>
            <div v-else class="info-section"><div class="info-box"><div class="info-box-icon">üì¶</div><p style="font-size: 16px; color: #666; margin-bottom: 8px;">Masukkan nomor DO untuk melacak pengiriman</p><p class="info-example">Contoh: DO2025-001</p></div></div>
        </div>
    </div>
</script>
<script type="text/x-template" id="tpl-order">
    <div class="order-form-container">
        <div class="page-header">
            <h2 class="page-title">‚ûï Form Pemesanan Delivery Order</h2>
            <button class="back-btn" @click="$emit('go-home')">‚Üê Kembali</button>
        </div>
        <div v-if="loading" class="loading-state"><p>Memuat data...</p></div>
        <div v-else-if="error" class="error-state"><p>{{ error }}</p><button class="btn btn-primary" @click="loadData">Coba Lagi</button></div>
        <div v-else>
            <div v-if="showSuccess" class="alert alert-success"><button class="alert-close" @click="closeSuccess">&times;</button><h4>‚úÖ Pesanan Berhasil Dibuat!</h4><p>Nomor DO: <strong>{{ savedDO.nomorDO }}</strong></p><p>Atas nama: <strong>{{ savedDO.nama }}</strong> ({{ savedDO.nim }})</p><p>Total: <strong>{{ formatCurrency(savedDO.total) }}</strong></p></div>
            <div class="form-section">
                <form @submit.prevent="submitForm" class="order-form">
                    <div class="form-group"><label>Nomor DO:</label><input type="text" v-model="form.nomorDO" class="form-control" readonly title="Nomor DO dibuat otomatis"><small class="form-hint">Nomor DO dibuat otomatis oleh sistem</small></div>
                    <div class="form-group"><label>NIM: *</label><input type="text" v-model="form.nim" class="form-control" :class="{ 'is-invalid': validationErrors.nim }" placeholder="Contoh: 123456789" maxlength="9"><span v-if="validationErrors.nim" class="error-message">{{ validationErrors.nim }}</span><small class="form-hint">9 digit angka</small></div>
                    <div class="form-group"><label>Nama Lengkap: *</label><input type="text" v-model="form.nama" class="form-control" :class="{ 'is-invalid': validationErrors.nama }" placeholder="Contoh: Rina Wulandari"><span v-if="validationErrors.nama" class="error-message">{{ validationErrors.nama }}</span></div>
                    <div class="form-group"><label>Ekspedisi: *</label><select v-model="form.ekspedisi" class="form-control" :class="{ 'is-invalid': validationErrors.ekspedisi }"><option value="">-- Pilih Ekspedisi --</option><option v-for="ekspedisi in pengirimanList" :key="ekspedisi.kode" :value="ekspedisi.kode">{{ ekspedisi.nama }}</option></select><span v-if="validationErrors.ekspedisi" class="error-message">{{ validationErrors.ekspedisi }}</span></div>
                    <div class="form-group"><label>Paket: *</label><select v-model="form.paket" class="form-control" :class="{ 'is-invalid': validationErrors.paket }"><option value="">-- Pilih Paket --</option><option v-for="paket in paketList" :key="paket.kode" :value="paket.kode">{{ paket.nama }} - {{ formatCurrency(paket.harga) }}</option></select><span v-if="validationErrors.paket" class="error-message">{{ validationErrors.paket }}</span></div>
                    <div v-if="selectedPaket" class="paket-info"><h4>üì¶ Detail Paket: {{ selectedPaket.nama }}</h4><ul><li v-for="(item, index) in selectedPaket.isi" :key="index">{{ item }}</li></ul><p class="paket-price">Harga: {{ formatCurrency(selectedPaket.harga) }}</p></div>
                    <div class="form-group">
                        <label>Tanggal Kirim: *</label>
                        <input type="date" v-model="form.tanggalKirim" class="form-control" :class="{ 'is-invalid': validationErrors.tanggalKirim }">
                        <span v-if="validationErrors.tanggalKirim" class="error-message">{{ validationErrors.tanggalKirim }}</span>
                        <small class="form-hint" v-if="form.tanggalKirim">Preview: {{ formatDateDisplay(form.tanggalKirim) }}</small>
                    </div>
                    <div class="form-group"><label>Total:</label><div class="total-display">{{ formatCurrency(form.total) }}</div><small class="form-hint">Total dihitung otomatis dari paket yang dipilih</small></div>
                    <div class="form-actions"><button type="submit" class="btn btn-primary btn-lg">üíæ Simpan Pesanan</button> <button type="button" class="btn btn-secondary" @click="resetForm">üîÑ Reset Form</button></div>
                    <p class="form-note">* Field wajib diisi</p>
                </form>
            </div>
        </div>
    </div>
</script>

    <!-- Load External JavaScript Files -->
    <script src="./js/services/api.js"></script>
    <script src="./js/components/status-badge.js"></script>
    <script src="./js/components/app-modal.js"></script>
    <script src="./js/components/stock-table.js"></script>
    <script src="./js/components/do-tracking.js"></script>
    <script src="./js/components/order-form.js"></script>
    
    <!-- Initialize Vue App -->
    <script>
        new Vue({
            el: '#app',
            data: {
                tab: 'home'
            }
        });
    </script>

</body>
</html>
